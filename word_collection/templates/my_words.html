{% extends 'base.html' %}

{% block title %}My Wortschatz{% endblock %}

{% block content %}

<style>
    .word-list-container {
        max-width: 600px;
        margin: 2rem auto;
    }
</style>

{% include 'word_details_style.html' %}

<h1>Meine Wörter</h1>
<div id="word-list" class="row word-list-container"></div>
<nav>
    <ul class="pagination justify-content-center">
        <li class="page-item"><a class="page-link" href="#" id="prev-page">« Zurück</a></li>
        <li class="page-item"><span class="page-link" id="current-page">Seite 1</span></li>
        <li class="page-item"><a class="page-link" href="#" id="next-page">Weiter »</a></li>
    </ul>
</nav>

{% include 'word_details.html' %}

{% verbatim %}
<script>
    let currentPage = 1;

    function loadWords(page = 1) {

        function replaceDefinition(card, definition) {
            card.querySelector("#definition-placeholder").innerText = definition;
        }

        function replaceGenus(card, genus_id) {
            function getGenusNameById(id) {
                switch (id) {
                    case 1: return "der";
                    case 2: return "die";
                    case 3: return "das";
                    case 4: return "die";
                    default: return null;
                }
            }

            genus_span = card.querySelector("#genus-placeholder")
            genus_name = getGenusNameById(genus_id)
            if (genus_name !== null) {
                genus_span.innerText = genus_span.innerText = genus_name;
                genus_span.classList.toggle('d-none');
            }
        }

        function replaceCategories(card, categories) {
            const categories_placeholder = card.querySelector("#categories-placeholder");
            categories.forEach(category => {
                category_span = document.createElement("span");
                category_span.classList.add("badge");
                category_span.classList.add("bg-success");
                category_span.innerText = `#${category.name}`;
                categories_placeholder.appendChild(category_span);
            })
        }

        function createCardHTML(template, word) {
            const card = template.content.cloneNode(true);
            replaceDefinition(card, word.definition);
            replaceGenus(card, word.genus_id);
            replaceCategories(card, word.categories_details);
            return card;
        }

        const jwtToken = localStorage.getItem("access");
        fetch(`/api/words/?page=${page}`, {
            method: "GET",
            headers: {
                "Authorization": "Bearer " + jwtToken
            }
        })
            .then(response => response.json())
            .then(data => {
                const wordList = document.getElementById("word-list");
                wordList.innerHTML = "";

                data.results.forEach(word => {
                    const template = document.getElementById("word-template");
                    const card = createCardHTML(template, word);
                    wordList.appendChild(card);
                });

                currentPage = page;
                document.getElementById("current-page").innerText = `Seite ${currentPage}`;

                document.getElementById("prev-page").parentElement.style.display = data.previous ? "block" : "none";
                document.getElementById("next-page").parentElement.style.display = data.next ? "block" : "none";
            })
            .catch(error => console.error("Fehler beim Laden der Wörter:", error));
    }

    function editWord(wordId) {
        alert("Bearbeiten von Wort " + wordId + " ist noch nicht implementiert.");
    }

    function deleteWord(wordId) {
        const jwtToken = localStorage.getItem("access");
        fetch(`/api/words/${wordId}/`, {
            method: "DELETE",
            headers: {
                "Authorization": "Bearer " + jwtToken
            }
        })
            .then(response => {
                if (response.ok) {
                    loadWords(currentPage);
                }
            })
            .catch(error => console.error("Fehler beim Löschen des Wortes:", error));
    }

    document.getElementById("prev-page").addEventListener("click", function (event) {
        event.preventDefault();
        if (currentPage > 1) {
            loadWords(currentPage - 1);
        }
    });

    document.getElementById("next-page").addEventListener("click", function (event) {
        event.preventDefault();
        loadWords(currentPage + 1);
    });

    document.addEventListener("DOMContentLoaded", () => loadWords(1));
</script>
{% endverbatim %}

{% endblock %}