<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Words</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body>
    <div class="container mt-5">
        <h2>User Words</h2>
        <ul class="list-group" id="word-list"></ul>

        <nav>
            <ul class="pagination justify-content-center mt-3" id="pagination"></ul>
        </nav>
    </div>

    <script>
        const apiBaseUrl = window.location.origin;
        const apiUrl = `${apiBaseUrl}/api/words/`;
        const loginPage = `${apiBaseUrl}/api/auth/login/`;
        const itemsPerPage = 10;
        let currentPage = 1;
        let words = [];

        async function fetchWords() {
            const token = localStorage.getItem("access");
            if (!token) {
                window.location.href = loginPage;
                return;
            }

            const response = await fetch(`${apiUrl}?page=${currentPage}`, {
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json"
                }
            });

            if (response.ok) {
                const data = await response.json();
                words = data;
                displayWords();
                setupPagination(data.count);
            } else if (response.status === 401) {
                localStorage.removeItem("access");
                window.location.href = loginPage;
            } else {
                console.error("Fehler beim Abrufen der WÃ¶rter");
            }
        }

        function displayWords() {
            const wordList = document.getElementById("word-list");
            wordList.innerHTML = "";

            words.forEach(word => {
                const li = document.createElement("li");
                li.className = "list-group-item";
                li.textContent = word.definition;
                wordList.appendChild(li);
            });
        }

        function setupPagination(totalWords) {
            const totalPages = Math.ceil(totalWords / itemsPerPage);
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";

            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement("li");
                li.className = "page-item" + (i === currentPage ? " active" : "");
                const a = document.createElement("a");
                a.className = "page-link";
                a.textContent = i;
                a.href = "#";
                a.onclick = function (e) {
                    e.preventDefault();
                    currentPage = i;
                    fetchWords();
                };
                li.appendChild(a);
                pagination.appendChild(li);
            }
        }

        fetchWords();
    </script>
</body>

</html>